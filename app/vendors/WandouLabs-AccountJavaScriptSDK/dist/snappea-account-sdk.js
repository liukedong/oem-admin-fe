!function(a){var b=window.$.Deferred,c=window.$.ajax;$.ajaxSetup&&$.ajaxSetup({xhrFields:{withCredentials:!0}});var d=function(a,b){if(!b)return a;var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},e={ajax:{error:-1,msg:"请求失败，请检查网络连接状况。"},missingParameters:{error:-2,msg:"参数不全"}},f="https://account.wandoujia.com",g="http://www.wandoujia.com/api/account",h="/v4/api",i=navigator.userAgent.toLowerCase().indexOf("msie")>-1,j=(i?g:f)+h,k={login:j+"/login",logout:j+"/logout",captcha:j+"/seccode",reg:j+"/register",checkUsername:j+"/isUsernameExisted",checkUserLogin:j+"/profile",checkUserLoginWithAuth:j+"/profile_with_auth",findPwd:j+"/findpassword",checkCode:j+"/checkcode",resetPwd:j+"/resetpassword",modifyPwd:j+"/profile/password",checkPasscode:j+"/checkpasscode",modifyPwdByCode:j+"/modifypassword",completeProfile:j+"/completeProfile",activate:j+"/activation/initialization",activateValid:j+"/activation/validation",unbindThirdParty:j+"/social/unbind",avatar:j+"/avatar",confirm:j+"/account/confirm"},l={loginWithThirdParty:f+"/web/oauth2/{1}/login"},m={},n=!1,o={};o.CAPTCHA=k.captcha,o.loginAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&a.password?c({type:"POST",dataType:"json",url:k.login,data:d({username:a.username,password:a.password,seccode:a.seccode||""},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),n=!0,m=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}):g.reject(e.missingParameters),g.promise()},o.isLogined=function(){return n},o.getUserInfo=function(){return m||{}},o.logoutAsync=function(a){var d=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"POST",dataType:f?"jsonp":"json",url:k.logout,data:a,crossDomain:f?!0:void 0,success:function(a){0===a.error?(n=!1,m=void 0,d.resolve(a)):d.reject(a)},error:function(a){4===a.readyState&&d.reject(a.responseJSON||{}),d.reject(e.ajax)}}),d.promise()},o.regAsync=function(a,f){var g=new b;return a=a||{},f=f||{},a.username&&(a.oneKeyRegister||a.password)?c({type:"POST",dataType:"json",url:k.reg,data:d({username:a.username,password:a.password,oneKeyRegister:a.oneKeyRegister||!1,nick:a.nickname||"",seccode:a.seccode||""},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),n=!0,m=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}):g.reject(e.missingParameters),g.promise()},o.checkUsernameAsync=function(a,f){var g=new b;return f=f||{},void 0===a?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.checkUsername,data:d({username:a},f),success:function(a){g.resolve(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.checkUserLoginAsync=function(a){var d=new b;a=a||{};var e=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:e?"jsonp":"json",url:k.checkUserLogin,data:a,crossDomain:e?!0:void 0,success:function(a){0===a.error?(n=!0,m=a.member,d.resolve(!0)):(n=!1,m=void 0,d.reject(!1))},error:function(){d.reject(!1)}}),d.promise()},o.checkUserLoginWithAuthAsync=function(a){var d=new b;a=a||{};var f=!!a.jsonp;return delete a.jsonp,c({type:"GET",dataType:f?"jsonp":"json",url:k.checkUserLoginWithAuth,data:a,crossDomain:f?!0:void 0,success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),n=!0,m=a.member,d.resolve(a.member)):(n=!1,m=void 0,d.reject(a))},error:function(a){4===a.readyState&&d.reject(a.responseJSON||{}),d.reject(e.ajax)}}),d.promise()},o.findPwdAsync=function(a,f){var g=new b;return f=f||{},void 0===a?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.findPwd,data:d({username:a},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.checkCodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.checkCode,data:d({username:a.username,passcode:a.passcode},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.resetPwdAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.resetPwd,data:d({username:a.username,passcode:a.passcode,password:a.password,repeatedpassword:a.password},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.modifyPwdAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.password||void 0===a.newpassword?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.modifyPwd,data:d({oldpassword:a.password,newpassword:a.newpassword},f),success:function(a,b,c){0===a.error?(a.member.auth=c.getResponseHeader("X-Wdj-Auth"),m=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.checkPasscodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.passcode?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.checkPasscode,data:d({passcode:a.passcode},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.modifyPwdByCodeAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.username||void 0===a.passcode||void 0===a.password?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.modifyPwdByCode,data:d({username:a.username,passcode:a.passcode,password:a.password},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.updateProfileAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.nickname?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.completeProfile,data:d({nick:a.nickname},f),success:function(a){0===a.error?(m=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.activateAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.type?g.reject(e.missingParameters):c({type:"GET",dataType:"json",url:k.activate,data:d({type:a.type},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.activateValidAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.code?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.activateValid,data:d({code:a.code,type:"sms"},f),success:function(a){0===a.error?(m.telephoneValidated=!0,g.resolve(a)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.uploadAvatarAsync=function(d,f){var g=new b;d=d||{},f=f||{};var h,i;if(void 0===d.file)g.reject(e.missingParameters);else{h=new a.FormData,h.append("file",d.file);for(i in f)f.hasOwnProperty(i)&&h.append(i,f[i]);c({type:"POST",dataType:"json",url:k.avatar,data:h,processData:!1,contentType:!1,success:function(a){0===a.error?(m=a.member,g.resolve(a.member.avatar)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}})}return g.promise()},o.unbindThirdPartyAsync=function(a,f){var g=new b;a=a||{},f=f||{};var h={weibo:"1",sina:"1",qq:"2",renren:"3"};return void 0===a.platform||void 0===h[a.platform]?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.unbindThirdParty,data:d({platid:h[a.platform]},f),success:function(a){0===a.error?(m=a.member,g.resolve(a.member)):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.confirmAsync=function(a,f){var g=new b;return a=a||{},f=f||{},void 0===a.code?g.reject(e.missingParameters):c({type:"POST",dataType:"json",url:k.confirm,data:d({code:a.code},f),success:function(a){0===a.error?g.resolve(a):g.reject(a)},error:function(a){4===a.readyState&&g.reject(a.responseJSON||{}),g.reject(e.ajax)}}),g.promise()},o.isEmail=function(a){var b=/^\s*?(.+)@(.+?)\.(.+?)\s*$/;return b.test(a)},o.isPhoneNumber=function(a){var b=/^1[34578]\d{9}$/;return b.test(a)},o.loginWithThirdParty=function(b){b=b||{},b.callback=b.callback||"http://www.wandoujia.com/";var c={weibo:"sina",sina:"sina",renren:"renren",qq:"qq"},d=c[b.platform];delete b.platform;var e=b.onclose||function(){};delete b.onclose;var f,g=[];for(f in b)b.hasOwnProperty(f)&&g.push(f+"="+a.encodeURIComponent(b[f]));var h=l.loginWithThirdParty.replace("{1}",d);if(g.length>0&&(h=h+"?"+g.join("&")),b.popup)var i=window.open(h,"loginWithThirdParty","width=650, height=480"),j=setInterval(function(){i.closed&&(clearInterval(j),e.call(this))},200);else a.location.href=h};var p=a.SnapPea||{};p.Account=o,a.SnapPea=p}(this);